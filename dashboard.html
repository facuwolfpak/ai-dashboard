<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolfpak Brands - Business Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .import-section {
            max-width: 1400px;
            margin: 0 auto 2rem auto;
        }

        .import-box {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 16px;
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #0f172a;
        }

        .import-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.3);
        }

        .import-box i {
            font-size: 2.5rem;
        }

        .import-text strong {
            font-size: 1.2rem;
            display: block;
            margin-bottom: 0.25rem;
        }

        .import-text p {
            margin: 0;
            opacity: 0.8;
        }

        .import-status {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #22c55e;
            margin-top: 1rem;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(34, 197, 94, 0.3);
            border-top: 2px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-box {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #475569;
            border-radius: 16px;
            padding: 1.5rem;
            min-height: 600px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 1.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-button {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s ease;
        }

        .add-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(34, 197, 94, 0.3);
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .item-card {
            background: rgba(51, 65, 85, 0.5);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #fbbf24;
        }

        .item-card:hover {
            background: rgba(51, 65, 85, 0.8);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.2);
        }

        .item-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
        }

        .item-details {
            font-size: 0.9rem;
            color: #94a3b8;
            line-height: 1.4;
        }

        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.5rem;
            margin-right: 0.5rem;
        }

        .status-active { background: rgba(34, 197, 94, 0.2); color: #86efac; }
        .status-pending { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        .status-negotiating { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }
        .status-on-hold { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid #475569;
            border-radius: 16px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #fbbf24;
        }

        .close-button {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        .close-button:hover {
            color: #e2e8f0;
        }

        .brand-status-item {
            background: rgba(51, 65, 85, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 3px solid #fbbf24;
        }

        .brand-status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .brand-status-name {
            font-weight: 600;
            color: #e2e8f0;
        }

        .progress-info {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }

        .pending-list {
            list-style: none;
            margin-top: 0.5rem;
        }

        .pending-item {
            padding: 0.25rem 0;
            color: #94a3b8;
            font-size: 0.85rem;
        }

        .pending-item::before {
            content: "‚Ä¢ ";
            color: #f59e0b;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid #64748b;
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 1rem;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border: none;
            border-radius: 8px;
            color: #0f172a;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
        }

        .btn-secondary {
            background: rgba(71, 85, 105, 0.5);
            border: 1px solid #64748b;
            border-radius: 8px;
            color: #e2e8f0;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            body {
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .modal-content {
                padding: 1rem;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <i class="fas fa-wolf-pack-battalion"></i>
            Wolfpak Brands
        </div>
        <div class="subtitle">Business Dashboard - Connecting Suppliers, Distributors & Retailers</div>
    </div>

    <!-- Excel Import Section -->
    <div class="import-section">
        <div class="import-box" onclick="document.getElementById('excelInput').click();">
            <i class="fas fa-file-excel"></i>
            <div class="import-text">
                <strong>Import Excel Dashboard</strong>
                <p>Upload your Excel file with multiple sheets - we'll automatically organize suppliers, distributors, and retailers</p>
            </div>
            <input type="file" id="excelInput" style="display: none;" accept=".xlsx,.xls" onchange="handleExcelImport(event)">
        </div>
        <div class="import-status" id="importStatus" style="display: none;">
            <div class="spinner"></div>
            <span>Processing Excel file...</span>
        </div>
    </div>

    <div class="main-grid">
        <!-- Brands/Suppliers Section -->
        <div class="section-box">
            <h2 class="section-title">
                <i class="fas fa-industry"></i>
                Brands / Suppliers
            </h2>
            <button class="add-button" onclick="openAddModal('supplier')">
                <i class="fas fa-plus"></i> Add New Supplier
            </button>
            <div class="item-list" id="supplierList">
                <!-- Suppliers will be populated here -->
            </div>
        </div>

        <!-- Distributors Section -->
        <div class="section-box">
            <h2 class="section-title">
                <i class="fas fa-truck"></i>
                Distributors
            </h2>
            <button class="add-button" onclick="openAddModal('distributor')">
                <i class="fas fa-plus"></i> Add New Distributor
            </button>
            <div class="item-list" id="distributorList">
                <!-- Distributors will be populated here -->
            </div>
        </div>

        <!-- Retailers Section -->
        <div class="section-box">
            <h2 class="section-title">
                <i class="fas fa-store"></i>
                Retailers
            </h2>
            <button class="add-button" onclick="openAddModal('retailer')">
                <i class="fas fa-plus"></i> Add New Retailer
            </button>
            <div class="item-list" id="retailerList">
                <!-- Retailers will be populated here -->
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal" id="addModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add New Item</h3>
                <button class="close-button" onclick="closeModal()">&times;</button>
            </div>
            <form id="addForm">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="itemName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Country/Region</label>
                    <input type="text" class="form-input" id="itemCountry" placeholder="e.g., Germany, USA, Global">
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Person</label>
                    <input type="text" class="form-input" id="itemContact">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="itemEmail">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="itemStatus">
                        <option value="active">Active</option>
                        <option value="pending">Pending</option>
                        <option value="negotiating">Negotiating</option>
                        <option value="on-hold">On Hold</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="itemNotes" placeholder="Additional information..."></textarea>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn-primary">Add Item</button>
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Distributor Details Modal -->
    <div class="modal" id="distributorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="distributorModalTitle">Distributor Details</h3>
                <button class="close-button" onclick="closeDistributorModal()">&times;</button>
            </div>
            <div id="distributorDetails">
                <!-- Distributor brand details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Supplier Details Modal -->
    <div class="modal" id="supplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="supplierModalTitle">Supplier Details</h3>
                <button class="close-button" onclick="closeSupplierModal()">&times;</button>
            </div>
            <div id="supplierDetails">
                <!-- Supplier details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let suppliers = [];
        let distributors = [];
        let retailers = [];
        let relationships = []; // Track which suppliers are working with which distributors/retailers

        // Sample data to start with
        function initSampleData() {
            suppliers = [
                {
                    id: 1,
                    name: "GreenLife Supplements",
                    country: "USA",
                    contact: "Sarah Johnson",
                    email: "sarah@greenlife.com",
                    status: "active",
                    notes: "Organic supplement manufacturer",
                    pendingItems: ["Product certification", "Label approval", "Pricing finalization"]
                },
                {
                    id: 2,
                    name: "TechFlow Electronics",
                    country: "South Korea",
                    contact: "Kim Min-jun",
                    email: "kim@techflow.kr",
                    status: "negotiating",
                    notes: "Consumer electronics manufacturer",
                    pendingItems: ["Contract review", "Sample shipment", "Regulatory documentation"]
                }
            ];

            distributors = [
                {
                    id: 1,
                    name: "European Health Distribution",
                    country: "Germany",
                    contact: "Hans Mueller",
                    email: "hans@ehd.de",
                    status: "active",
                    notes: "Leading health product distributor in EU"
                },
                {
                    id: 2,
                    name: "Pacific Trade Partners",
                    country: "Australia",
                    contact: "Emma Wilson",
                    email: "emma@pacifictrade.au",
                    status: "pending",
                    notes: "Electronics and lifestyle products"
                }
            ];

            retailers = [
                {
                    id: 1,
                    name: "Healthy Living Stores",
                    country: "Germany",
                    contact: "Maria Schmidt",
                    email: "maria@healthyliving.de",
                    status: "active",
                    notes: "Chain of 150 health stores across Germany"
                }
            ];

            // Sample relationships (supplier_id, distributor_id, retailer_id, status, progress)
            relationships = [
                {
                    supplierId: 1,
                    distributorId: 1,
                    retailerId: 1,
                    status: "negotiating",
                    progress: "Contract review stage",
                    pendingItems: ["Final pricing", "Delivery terms"]
                },
                {
                    supplierId: 2,
                    distributorId: 2,
                    retailerId: null,
                    status: "pending",
                    progress: "Initial discussions",
                    pendingItems: ["Product samples", "Market analysis"]
                }
            ];

            renderAll();
        }

        // Render functions
        function renderSuppliers() {
            const container = document.getElementById('supplierList');
            
            if (suppliers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-industry"></i>
                        <p>No suppliers added yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = suppliers.map(supplier => {
                const supplierRelationships = relationships.filter(r => r.supplierId === supplier.id);
                const activeDeals = supplierRelationships.length;
                
                return `
                    <div class="item-card" onclick="showSupplierDetails(${supplier.id})">
                        <div class="item-name">${supplier.name}</div>
                        <div class="item-details">
                            üìç ${supplier.country} | üë§ ${supplier.contact}<br>
                            ü§ù ${activeDeals} active deal${activeDeals !== 1 ? 's' : ''} | üìã ${supplier.pendingItems.length} pending items
                        </div>
                        <span class="status-badge status-${supplier.status}">${supplier.status.toUpperCase()}</span>
                    </div>
                `;
            }).join('');
        }

        function renderDistributors() {
            const container = document.getElementById('distributorList');
            
            if (distributors.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-truck"></i>
                        <p>No distributors added yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = distributors.map(distributor => {
                const distributorRelationships = relationships.filter(r => r.distributorId === distributor.id);
                const brandsCount = distributorRelationships.length;
                
                return `
                    <div class="item-card" onclick="showDistributorDetails(${distributor.id})">
                        <div class="item-name">${distributor.name}</div>
                        <div class="item-details">
                            üìç ${distributor.country} | üë§ ${distributor.contact}<br>
                            üè∑Ô∏è ${brandsCount} brand${brandsCount !== 1 ? 's' : ''} in pipeline
                        </div>
                        <span class="status-badge status-${distributor.status}">${distributor.status.toUpperCase()}</span>
                    </div>
                `;
            }).join('');
        }

        function renderRetailers() {
            const container = document.getElementById('retailerList');
            
            if (retailers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-store"></i>
                        <p>No retailers added yet</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = retailers.map(retailer => {
                const retailerRelationships = relationships.filter(r => r.retailerId === retailer.id);
                const brandsCount = retailerRelationships.length;
                
                return `
                    <div class="item-card">
                        <div class="item-name">${retailer.name}</div>
                        <div class="item-details">
                            üìç ${retailer.country} | üë§ ${retailer.contact}<br>
                            üè∑Ô∏è ${brandsCount} brand${brandsCount !== 1 ? 's' : ''} being sold
                        </div>
                        <span class="status-badge status-${retailer.status}">${retailer.status.toUpperCase()}</span>
                    </div>
                `;
            }).join('');
        }

        function renderAll() {
            renderSuppliers();
            renderDistributors();
            renderRetailers();
        }

        // Modal functions
        function openAddModal(type) {
            const modal = document.getElementById('addModal');
            const title = document.getElementById('modalTitle');
            
            title.textContent = `Add New ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            modal.dataset.type = type;
            modal.classList.add('show');
            
            // Clear form
            document.getElementById('addForm').reset();
        }

        function closeModal() {
            document.getElementById('addModal').classList.remove('show');
        }

        function showDistributorDetails(distributorId) {
            const distributor = distributors.find(d => d.id === distributorId);
            const distributorRelationships = relationships.filter(r => r.distributorId === distributorId);
            
            const modal = document.getElementById('distributorModal');
            const title = document.getElementById('distributorModalTitle');
            const details = document.getElementById('distributorDetails');
            
            title.textContent = `${distributor.name} - Brand Pipeline`;
            
            if (distributorRelationships.length === 0) {
                details.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-handshake"></i>
                        <p>No brands currently in pipeline with this distributor</p>
                    </div>
                `;
            } else {
                details.innerHTML = distributorRelationships.map(relationship => {
                    const supplier = suppliers.find(s => s.id === relationship.supplierId);
                    const retailer = relationship.retailerId ? retailers.find(r => r.id === relationship.retailerId) : null;
                    
                    return `
                        <div class="brand-status-item">
                            <div class="brand-status-header">
                                <span class="brand-status-name">${supplier.name}</span>
                                <span class="status-badge status-${relationship.status}">${relationship.status.toUpperCase()}</span>
                            </div>
                            <div class="progress-info">
                                üìà Progress: ${relationship.progress}
                                ${retailer ? `<br>üè™ End Retailer: ${retailer.name}` : ''}
                            </div>
                            ${relationship.pendingItems.length > 0 ? `
                                <div>
                                    <strong>Pending Items:</strong>
                                    <ul class="pending-list">
                                        ${relationship.pendingItems.map(item => `<li class="pending-item">${item}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
            }
            
            modal.classList.add('show');
        }

        function closeDistributorModal() {
            document.getElementById('distributorModal').classList.remove('show');
        }

        function showSupplierDetails(supplierId) {
            const supplier = suppliers.find(s => s.id === supplierId);
            const supplierRelationships = relationships.filter(r => r.supplierId === supplierId);
            
            const modal = document.getElementById('supplierModal');
            const title = document.getElementById('supplierModalTitle');
            const details = document.getElementById('supplierDetails');
            
            title.textContent = `${supplier.name} - Overview`;
            
            details.innerHTML = `
                <div class="brand-status-item">
                    <div class="brand-status-header">
                        <span class="brand-status-name">Pending from Supplier</span>
                    </div>
                    ${supplier.pendingItems.length > 0 ? `
                        <ul class="pending-list">
                            ${supplier.pendingItems.map(item => `<li class="pending-item">${item}</li>`).join('')}
                        </ul>
                    ` : '<p class="progress-info">‚úÖ No pending items</p>'}
                </div>
                
                <div class="brand-status-item">
                    <div class="brand-status-header">
                        <span class="brand-status-name">Distribution Network</span>
                    </div>
                    ${supplierRelationships.length > 0 ? 
                        supplierRelationships.map(relationship => {
                            const distributor = distributors.find(d => d.id === relationship.distributorId);
                            const retailer = relationship.retailerId ? retailers.find(r => r.id === relationship.retailerId) : null;
                            
                            return `
                                <div class="progress-info">
                                    üöõ <strong>${distributor.name}</strong> (${distributor.country})
                                    ${retailer ? `<br>   ‚îî‚îÄ üè™ ${retailer.name}` : ''}
                                    <br>   üìä Status: <span class="status-badge status-${relationship.status}">${relationship.status.toUpperCase()}</span>
                                </div>
                            `;
                        }).join('')
                        : '<p class="progress-info">No active distribution partnerships</p>'
                    }
                </div>
            `;
            
            modal.classList.add('show');
        }

        function closeSupplierModal() {
            document.getElementById('supplierModal').classList.remove('show');
        }

        // Form submission
        document.getElementById('addForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.getElementById('addModal').dataset.type;
            const formData = {
                id: Date.now(), // Simple ID generation
                name: document.getElementById('itemName').value,
                country: document.getElementById('itemCountry').value,
                contact: document.getElementById('itemContact').value,
                email: document.getElementById('itemEmail').value,
                status: document.getElementById('itemStatus').value,
                notes: document.getElementById('itemNotes').value
            };
            
            if (type === 'supplier') {
                formData.pendingItems = []; // Initialize empty pending items
                suppliers.push(formData);
            } else if (type === 'distributor') {
                distributors.push(formData);
            } else if (type === 'retailer') {
                retailers.push(formData);
            }
            
            renderAll();
            closeModal();
        });

        // Excel Import Functionality - Customized for Wolfpak DASHBOARD 2025.xlsx
        async function handleExcelImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const statusElement = document.getElementById('importStatus');
            statusElement.style.display = 'flex';
            statusElement.innerHTML = '<div class="spinner"></div><span>Reading your DASHBOARD 2025.xlsx file...</span>';

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data, {type: 'array'});
                
                statusElement.innerHTML = '<div class="spinner"></div><span>Processing: ' + workbook.SheetNames.join(', ') + '</span>';

                // Clear existing data
                suppliers = [];
                distributors = [];
                retailers = [];
                relationships = [];

                // Process each sheet according to Wolfpak structure
                if (workbook.Sheets["Supplier"]) {
                    suppliers = parseWolfpakSuppliers(workbook.Sheets["Supplier"]);
                    statusElement.innerHTML = '<div class="spinner"></div><span>Imported ' + suppliers.length + ' suppliers...</span>';
                }

                if (workbook.Sheets["DashBoard"]) {
                    const dashboardData = parseWolfpakDashboard(workbook.Sheets["DashBoard"]);
                    distributors = distributors.concat(dashboardData.distributors);
                    retailers = retailers.concat(dashboardData.retailers);
                    relationships = relationships.concat(dashboardData.relationships);
                    statusElement.innerHTML = '<div class="spinner"></div><span>Imported ' + relationships.length + ' active deals...</span>';
                }

                if (workbook.Sheets["Look Up List"]) {
                    const lookupData = parseWolfpakLookup(workbook.Sheets["Look Up List"]);
                    // Add additional distributors and retailers from lookup
                    distributors = distributors.concat(lookupData.distributors);
                    retailers = retailers.concat(lookupData.retailers);
                    statusElement.innerHTML = '<div class="spinner"></div><span>Added lookup data...</span>';
                }

                // Remove duplicates
                suppliers = removeDuplicates(suppliers, 'name');
                distributors = removeDuplicates(distributors, 'name');
                retailers = removeDuplicates(retailers, 'name');

                // Update the dashboard
                renderAll();
                
                statusElement.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>Import complete! ${suppliers.length} suppliers, ${distributors.length} distributors, ${retailers.length} retailers, ${relationships.length} active deals</span>
                `;
                
                setTimeout(() => {
                    statusElement.style.display = 'none';
                }, 5000);

            } catch (error) {
                console.error('Error importing Excel:', error);
                statusElement.innerHTML = `
                    <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                    <span style="color: #ef4444;">Error importing file: ${error.message}</span>
                `;
            }
        }

        // Parse Supplier sheet - specific to Wolfpak format
        function parseWolfpakSuppliers(sheet) {
            const range = XLSX.utils.decode_range(sheet['!ref']);
            const suppliers = [];
            
            // Headers are in row 2 (index 1): Brand, Country, Owner, Discovery, Spec Sheets, Price List, etc.
            for (let row = 2; row <= range.e.r; row++) {
                const brandCell = sheet[XLSX.utils.encode_cell({r: row, c: 0})]; // Brand
                const countryCell = sheet[XLSX.utils.encode_cell({r: row, c: 1})]; // Country  
                const ownerCell = sheet[XLSX.utils.encode_cell({r: row, c: 2})]; // Owner
                const discoveryCell = sheet[XLSX.utils.encode_cell({r: row, c: 3})]; // Discovery
                const specSheetsCell = sheet[XLSX.utils.encode_cell({r: row, c: 4})]; // Spec Sheets
                const priceListCell = sheet[XLSX.utils.encode_cell({r: row, c: 5})]; // Price List
                const externalDeckCell = sheet[XLSX.utils.encode_cell({r: row, c: 6})]; // External Deck
                const internalDeckCell = sheet[XLSX.utils.encode_cell({r: row, c: 7})]; // Internal Deck
                const ndaCell = sheet[XLSX.utils.encode_cell({r: row, c: 8})]; // NDA
                const brokerContractCell = sheet[XLSX.utils.encode_cell({r: row, c: 9})]; // Broker Contract
                const tdsCell = sheet[XLSX.utils.encode_cell({r: row, c: 10})]; // TDS
                
                if (!brandCell || !brandCell.v) continue;
                
                // Build pending items list
                const pendingItems = [];
                if (!discoveryCell || discoveryCell.v !== "Done") pendingItems.push("Discovery");
                if (!specSheetsCell || specSheetsCell.v !== "Done") pendingItems.push("Spec Sheets");
                if (!priceListCell || priceListCell.v !== "Done") pendingItems.push("Price List");
                if (!externalDeckCell || externalDeckCell.v !== "Done") pendingItems.push("External Deck");
                if (!internalDeckCell || internalDeckCell.v !== "Done") pendingItems.push("Internal Deck");
                if (!ndaCell || ndaCell.v !== "Done") pendingItems.push("NDA");
                if (!brokerContractCell || brokerContractCell.v !== "Done") pendingItems.push("Broker Contract");
                if (!tdsCell || tdsCell.v !== "Done") pendingItems.push("TDS");
                
                suppliers.push({
                    id: Date.now() + row,
                    name: brandCell.v,
                    country: countryCell ? countryCell.v : 'Not specified',
                    contact: ownerCell ? ownerCell.v : 'Not specified',
                    email: '',
                    status: pendingItems.length === 0 ? 'active' : 'pending',
                    notes: `Owner: ${ownerCell ? ownerCell.v : 'TBD'}`,
                    pendingItems: pendingItems
                });
            }
            
            return suppliers;
        }

        // Parse Dashboard sheet - specific to Wolfpak format  
        function parseWolfpakDashboard(sheet) {
            const range = XLSX.utils.decode_range(sheet['!ref']);
            const distributors = [];
            const retailers = [];
            const relationships = [];
            const distributorMap = new Map();
            const retailerMap = new Map();
            
            // Headers in row 2: Probability, Brand, Country, Distributor, Retailer, Owner, SOP, SOC, etc.
            for (let row = 2; row <= range.e.r; row++) {
                const probCell = sheet[XLSX.utils.encode_cell({r: row, c: 0})]; // Probability
                const brandCell = sheet[XLSX.utils.encode_cell({r: row, c: 1})]; // Brand
                const countryCell = sheet[XLSX.utils.encode_cell({r: row, c: 2})]; // Country
                const distributorCell = sheet[XLSX.utils.encode_cell({r: row, c: 3})]; // Distributor
                const retailerCell = sheet[XLSX.utils.encode_cell({r: row, c: 4})]; // Retailer
                const ownerCell = sheet[XLSX.utils.encode_cell({r: row, c: 5})]; // Owner
                const sopCell = sheet[XLSX.utils.encode_cell({r: row, c: 6})]; // SOP
                const socCell = sheet[XLSX.utils.encode_cell({r: row, c: 7})]; // SOC
                const presentedCell = sheet[XLSX.utils.encode_cell({r: row, c: 8})]; // Presented
                
                if (!brandCell || !brandCell.v || !distributorCell || !distributorCell.v) continue;
                
                const distributor = distributorCell.v;
                const retailer = retailerCell ? retailerCell.v : '';
                const country = countryCell ? countryCell.v : '';
                const probability = probCell ? probCell.v : 'Med';
                
                // Track unique distributors
                if (!distributorMap.has(distributor)) {
                    distributorMap.set(distributor, {
                        id: Date.now() + distributors.length,
                        name: distributor,
                        country: country,
                        contact: 'Not specified',
                        email: '',
                        status: 'active',
                        notes: `Active in ${country}`
                    });
                }
                
                // Track unique retailers
                if (retailer && !retailerMap.has(retailer)) {
                    retailerMap.set(retailer, {
                        id: Date.now() + retailers.length + 1000,
                        name: retailer,
                        country: country,
                        contact: 'Not specified', 
                        email: '',
                        status: 'active',
                        notes: `Active in ${country}`
                    });
                }
                
                // Create relationship
                const pendingItems = [];
                if (!presentedCell || presentedCell.v !== "Done") pendingItems.push("Presentation");
                if (!sopCell || !sopCell.v) pendingItems.push("SOP Agreement");
                if (!socCell || !socCell.v) pendingItems.push("SOC Documentation");
                
                relationships.push({
                    supplierId: findSupplierIdByName(brandCell.v),
                    distributorId: distributorMap.get(distributor).id,
                    retailerId: retailer ? retailerMap.get(retailer).id : null,
                    status: mapProbabilityToStatus(probability),
                    progress: `${probability} probability - ${country} market`,
                    pendingItems: pendingItems
                });
            }
            
            return {
                distributors: Array.from(distributorMap.values()),
                retailers: Array.from(retailerMap.values()),
                relationships: relationships
            };
        }

        // Parse Look Up List sheet - specific to Wolfpak format
        function parseWolfpakLookup(sheet) {
            const range = XLSX.utils.decode_range(sheet['!ref']);
            const distributors = [];
            const retailers = [];
            const distributorSet = new Set();
            const retailerSet = new Set();
            
            // Headers in row 2: [blank], Supplier, [blank], Country, [blank], Distributor, [blank], Retailer, [blank], Owner
            for (let row = 2; row <= range.e.r; row++) {
                const distributorCell = sheet[XLSX.utils.encode_cell({r: row, c: 5})]; // Distributor
                const retailerCell = sheet[XLSX.utils.encode_cell({r: row, c: 7})]; // Retailer
                const countryCell = sheet[XLSX.utils.encode_cell({r: row, c: 3})]; // Country
                
                // Add distributors
                if (distributorCell && distributorCell.v && !distributorSet.has(distributorCell.v)) {
                    distributorSet.add(distributorCell.v);
                    distributors.push({
                        id: Date.now() + distributors.length + 2000,
                        name: distributorCell.v,
                        country: countryCell ? countryCell.v : 'Multiple',
                        contact: 'Not specified',
                        email: '',
                        status: 'pending',
                        notes: 'From lookup list - not yet in active pipeline'
                    });
                }
                
                // Add retailers
                if (retailerCell && retailerCell.v && !retailerSet.has(retailerCell.v)) {
                    retailerSet.add(retailerCell.v);
                    retailers.push({
                        id: Date.now() + retailers.length + 3000,
                        name: retailerCell.v,
                        country: countryCell ? countryCell.v : 'Multiple',
                        contact: 'Not specified',
                        email: '',
                        status: 'pending',
                        notes: 'From lookup list - potential target'
                    });
                }
            }
            
            return { distributors, retailers };
        }

        // Helper functions
        function findSupplierIdByName(name) {
            const supplier = suppliers.find(s => s.name.toLowerCase() === name.toLowerCase());
            return supplier ? supplier.id : Date.now();
        }

        function mapProbabilityToStatus(probability) {
            if (!probability) return 'pending';
            const prob = probability.toString().toLowerCase();
            if (prob.includes('hi')) return 'negotiating';
            if (prob.includes('med')) return 'pending';
            if (prob.includes('lo')) return 'on-hold';
            return 'pending';
        }

        function removeDuplicates(array, key) {
            const seen = new Set();
            return array.filter(item => {
                const keyValue = item[key].toLowerCase();
                if (seen.has(keyValue)) {
                    return false;
                }
                seen.add(keyValue);
                return true;
            });
        }

        // Initialize the dashboard
        initSampleData();
    </script>
</body>
</html>
