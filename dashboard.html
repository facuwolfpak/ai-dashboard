<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Debrief Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .voice-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .voice-section h2 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .record-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .record-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .record-btn.recording {
            background: linear-gradient(45deg, #ff4757, #c44569);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 75, 87, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 75, 87, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 75, 87, 0); }
        }

        .mic-icon {
            font-size: 2rem;
            color: white;
        }

        .status {
            text-align: center;
            margin-top: 15px;
            font-weight: 500;
        }

        .query-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .query-input {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .query-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .quick-queries {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .quick-query-btn {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
        }

        .quick-query-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: auto;
        }

        .status-green { background: #2ed573; }
        .status-yellow { background: #ffa502; }
        .status-red { background: #ff4757; }

        .card-content {
            line-height: 1.6;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric:last-child {
            border-bottom: none;
        }

        .transcript {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .response-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            min-height: 150px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        .pending-alert {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .timestamp {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ AI Debrief Dashboard</h1>
            <p>Voice-powered insights and intelligent project tracking</p>
        </div>

        <div class="main-grid">
            <div class="voice-section">
                <h2>üé§ Daily Debrief</h2>
                <button class="record-btn" id="recordBtn">
                    <span class="mic-icon">üé§</span>
                </button>
                <div class="status" id="voiceStatus">Click to start recording</div>
                <div class="transcript" id="transcript" style="display: none;">
                    <div>Transcript will appear here...</div>
                </div>
            </div>

            <div class="query-section">
                <h2>üîç Ask Anything</h2>
                <input type="text" class="query-input" id="queryInput" placeholder="Ask about your projects... 'Where are we on Bahamas?'">
                
                <div class="quick-queries">
                    <button class="quick-query-btn" data-query="bahamas">üìç Where are we on Bahamas?</button>
                    <button class="quick-query-btn" data-query="pending">‚ö†Ô∏è Show pending items</button>
                    <button class="quick-query-btn" data-query="timeline">üìÖ Project timelines</button>
                    <button class="quick-query-btn" data-query="budget">üí∞ Budget status</button>
                </div>

                <div class="response-area" id="responseArea">
                    <div style="opacity: 0.6;">Ask a question to see AI-organized insights...</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">üèùÔ∏è Bahamas Project</div>
                    <div class="status-indicator status-yellow"></div>
                </div>
                <div class="card-content">
                    <div class="metric">
                        <span>Progress:</span>
                        <span>65% Complete</span>
                    </div>
                    <div class="metric">
                        <span>Budget:</span>
                        <span>$850k / $1.2M</span>
                    </div>
                    <div class="metric">
                        <span>Timeline:</span>
                        <span>2 weeks behind</span>
                    </div>
                    <div class="pending-alert">
                        <strong>‚ö†Ô∏è Pending:</strong> Environmental permits approval needed
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">üöÄ Miami Expansion</div>
                    <div class="status-indicator status-green"></div>
                </div>
                <div class="card-content">
                    <div class="metric">
                        <span>Progress:</span>
                        <span>92% Complete</span>
                    </div>
                    <div class="metric">
                        <span>Budget:</span>
                        <span>$2.1M / $2.3M</span>
                    </div>
                    <div class="metric">
                        <span>Timeline:</span>
                        <span>On track</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">üè¢ Office Renovation</div>
                    <div class="status-indicator status-red"></div>
                </div>
                <div class="card-content">
                    <div class="metric">
                        <span>Progress:</span>
                        <span>30% Complete</span>
                    </div>
                    <div class="metric">
                        <span>Budget:</span>
                        <span>$450k / $500k</span>
                    </div>
                    <div class="metric">
                        <span>Timeline:</span>
                        <span>4 weeks delayed</span>
                    </div>
                    <div class="pending-alert">
                        <strong>üö® Critical:</strong> Contractor selection overdue
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-title">üìä Weekly Analytics</div>
                    <div class="status-indicator status-green"></div>
                </div>
                <div class="card-content">
                    <div class="metric">
                        <span>Team Productivity:</span>
                        <span>+15%</span>
                    </div>
                    <div class="metric">
                        <span>Active Projects:</span>
                        <span>12</span>
                    </div>
                    <div class="metric">
                        <span>Completed Tasks:</span>
                        <span>47 this week</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All global variables
        let isRecording = false;
        let recognition = null;
        let voiceMemory = []; // Store all voice inputs for querying

        // Project data - will be updated with voice inputs
        const projectData = {
            bahamas: {
                status: "In Progress - Behind Schedule",
                progress: "65% complete",
                budget: "$850k spent of $1.2M budget",
                timeline: "2 weeks behind original schedule",
                lastUpdate: "Environmental permits still pending approval from Nassau authorities",
                keyMilestones: [
                    "Site survey: ‚úÖ Completed",
                    "Design phase: ‚úÖ Completed", 
                    "Permits: ‚ö†Ô∏è Pending (blocking construction)",
                    "Construction: üìÖ Waiting for permits"
                ],
                risks: "Permit delays could extend timeline by additional 3-4 weeks",
                nextSteps: "Follow up with local authorities, prepare alternative timeline",
                voiceNotes: [] // Store voice-specific information
            }
        };

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true; // Keep listening continuously
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                let silenceTimer = null;
                let lastSpeechTime = Date.now();
                let fullTranscript = '';

                recognition.onstart = function() {
                    isRecording = true;
                    updateRecordingState();
                    document.getElementById('voiceStatus').textContent = 'üé§ Recording... (click button to stop)';
                    document.getElementById('transcript').style.display = 'block';
                    document.getElementById('transcript').innerHTML = '<div>Listening for your voice...</div>';
                    fullTranscript = '';
                    console.log('Continuous recording started');
                };

                recognition.onresult = function(event) {
                    // Clear silence timer since we got speech
                    if (silenceTimer) {
                        clearTimeout(silenceTimer);
                        silenceTimer = null;
                    }
                    lastSpeechTime = Date.now();

                    // Build the full transcript
                    let interimTranscript = '';
                    let finalTranscript = '';

                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript + ' ';
                        } else {
                            interimTranscript += transcript;
                        }
                    }

                    // Update full transcript
                    if (finalTranscript) {
                        fullTranscript += finalTranscript;
                    }

                    // Display current state
                    const displayText = fullTranscript + (interimTranscript ? '<span style="opacity:0.6;">' + interimTranscript + '</span>' : '');
                    document.getElementById('transcript').innerHTML = `<div>"${displayText}"</div>`;
                    
                    // Update status
                    document.getElementById('voiceStatus').textContent = 'üé§ Recording... (click button to stop)';

                    // Start silence timer for auto-stop after 1 minute
                    if (silenceTimer) clearTimeout(silenceTimer);
                    silenceTimer = setTimeout(() => {
                        if (isRecording) {
                            console.log('Auto-stopping due to 1 minute of silence');
                            stopRecording();
                        }
                    }, 60000); // 60 seconds
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    
                    if (event.error === 'not-allowed') {
                        isRecording = false;
                        updateRecordingState();
                        document.getElementById('voiceStatus').innerHTML = `
                            <div style="color: #ff6b6b; margin-bottom: 10px;">üö´ Microphone access denied</div>
                            <div style="font-size: 0.9rem; line-height: 1.4;">
                                Click the üîí lock icon in your address bar to allow microphone access, then try again.
                            </div>
                        `;
                    } else if (event.error === 'no-speech') {
                        // Don't stop on no-speech since we want continuous recording
                        console.log('No speech detected, continuing to listen...');
                    } else {
                        isRecording = false;
                        updateRecordingState();
                        document.getElementById('voiceStatus').textContent = `‚ùå Error: ${event.error}. Click to try again.`;
                    }
                };

                recognition.onend = function() {
                    console.log('Speech recognition ended');
                    
                    // Process the full transcript if we have one
                    if (fullTranscript.trim() && isRecording === false) {
                        document.getElementById('voiceStatus').textContent = '‚úÖ Processing your recording...';
                        setTimeout(() => {
                            processVoiceInput(fullTranscript.trim());
                            document.getElementById('voiceStatus').innerHTML = `
                                <div>‚úÖ Recording processed!</div>
                                <div style="font-size: 0.8rem; margin-top: 5px;">
                                    Click microphone to record again
                                </div>
                            `;
                        }, 1000);
                    }
                    
                    // Clear timers
                    if (silenceTimer) {
                        clearTimeout(silenceTimer);
                        silenceTimer = null;
                    }
                };

                console.log('‚úÖ Continuous speech recognition initialized');
                return true;
            }
            console.log('‚ùå Speech recognition not supported');
            return false;
        }

        function updateRecordingState() {
            const btn = document.getElementById('recordBtn');
            const status = document.getElementById('voiceStatus');
            
            if (isRecording) {
                btn.classList.add('recording');
                btn.title = 'Click to stop recording';
            } else {
                btn.classList.remove('recording');
                btn.title = 'Click to start recording';
                if (status.textContent.includes('Recording')) {
                    status.textContent = 'Click to start recording';
                }
            }
        }

        function startRecording() {
            if (!recognition) {
                // Fallback to demo if speech recognition not available
                startVoiceDemo();
                return;
            }

            if (isRecording) {
                // Stop recording
                stopRecording();
                return;
            }

            try {
                document.getElementById('voiceStatus').textContent = 'Starting microphone...';
                recognition.start();
            } catch (error) {
                console.error('Error starting recognition:', error);
                document.getElementById('voiceStatus').textContent = 'Error starting microphone. Trying demo...';
                setTimeout(startVoiceDemo, 1000);
            }
        }

        function stopRecording() {
            if (recognition && isRecording) {
                isRecording = false; // Set this first to prevent auto-restart
                updateRecordingState();
                recognition.stop();
                document.getElementById('voiceStatus').textContent = 'Stopping recording...';
                console.log('Manual stop requested');
            }
        }

        function startVoiceDemo() {
            console.log('Starting voice demo fallback...');
            document.getElementById('voiceStatus').textContent = 'Demo: Simulating voice input...';
            document.getElementById('transcript').style.display = 'block';
            
            const sampleTranscript = "Today we made significant progress on the Miami expansion - we're now at 92% completion and should finish on schedule. However, the Bahamas project hit another snag - we're still waiting for those environmental permits from Nassau. This is now putting us 2 weeks behind schedule. I spoke with our legal team and they think we might need to escalate this to higher authorities. On the positive side, our budget is still looking good across all projects. The office renovation is concerning me though - we still haven't selected a contractor and we're already 4 weeks delayed. We need to make some decisions fast.";
            
            let i = 0;
            const typingInterval = setInterval(() => {
                document.getElementById('transcript').innerHTML = `<div>"${sampleTranscript.substring(0, i)}"</div>`;
                i += 2;
                if (i > sampleTranscript.length) {
                    clearInterval(typingInterval);
                    document.getElementById('voiceStatus').textContent = 'Demo complete - AI processing...';
                    setTimeout(() => {
                        processVoiceInput(sampleTranscript);
                        document.getElementById('voiceStatus').innerHTML = `
                            <div>‚úÖ Demo complete!</div>
                            <div style="font-size: 0.8rem; margin-top: 5px; color: #ffa502;">
                                For real voice: Allow microphone access in browser settings
                            </div>
                        `;
                    }, 1000);
                }
            }, 30);
        }

        function processVoiceInput(transcript) {
            // Store the voice input with timestamp
            const voiceEntry = {
                timestamp: new Date(),
                text: transcript,
                processed: new Date().toLocaleString()
            };
            voiceMemory.push(voiceEntry);
            
            // Parse the transcript for key information
            const parsedInfo = parseVoiceForKeyInfo(transcript);
            
            // Update project data with new information
            if (parsedInfo.project && projectData[parsedInfo.project]) {
                if (parsedInfo.details.length > 0) {
                    projectData[parsedInfo.project].voiceNotes = projectData[parsedInfo.project].voiceNotes || [];
                    projectData[parsedInfo.project].voiceNotes.push(...parsedInfo.details);
                }
            }

            const responseArea = document.getElementById('responseArea');
            responseArea.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>üé§ Voice Input Processed:</strong> "${transcript.substring(0, 100)}..."
                </div>
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <strong>AI Analysis Detected:</strong><br>
                    ${parsedInfo.summary || 'General project update recorded'}
                    ${parsedInfo.details.length > 0 ? '<br><br><strong>Key Details:</strong><br>‚Ä¢ ' + parsedInfo.details.join('<br>‚Ä¢ ') : ''}
                </div>
                <div style="background: rgba(46, 213, 115, 0.2); padding: 10px; border-radius: 8px;">
                    ‚úÖ Information stored and ready for queries
                </div>
                <div class="timestamp">Processed at ${new Date().toLocaleTimeString()}</div>
            `;

            console.log('Voice memory updated:', voiceMemory);
            console.log('Project data updated:', projectData);
        }

        function parseVoiceForKeyInfo(transcript) {
            const lowerTranscript = transcript.toLowerCase();
            const result = {
                project: null,
                details: [],
                summary: null
            };

            // Detect project mentions
            if (lowerTranscript.includes('bahamas') || lowerTranscript.includes('bahama')) {
                result.project = 'bahamas';
            }

            // Parse specific information patterns
            const patterns = [
                // Yellow Bird / Yellowbird pattern
                {
                    regex: /(\d+)\s+(pallets?|pallet)\s+(?:of\s+)?(?:yellow\s*bird|yellowbird)/i,
                    extract: (match) => `${match[1]} pallets of Yellow Bird ordered`
                },
                // Date patterns
                {
                    regex: /(january|february|march|april|may|june|july|august|september|october|november|december)\s+(\d{1,2})/i,
                    extract: (match) => `Scheduled for ${match[1]} ${match[2]}`
                },
                // Budget/money patterns
                {
                    regex: /\$?([\d,]+)(?:\s*(?:dollars?|k|thousand|million))?/i,
                    extract: (match) => `Budget item: ${match[1]}`
                },
                // Commitment/purchase patterns
                {
                    regex: /(commit|committed|committing|buying|purchase|ordered?).*?(\d+.*?)(?:on|by|before)/i,
                    extract: (match) => `Commitment: ${match[2]}`
                }
            ];

            patterns.forEach(pattern => {
                const match = transcript.match(pattern.regex);
                if (match) {
                    result.details.push(pattern.extract(match));
                }
            });

            // Generate summary
            if (result.project && result.details.length > 0) {
                result.summary = `${result.project.charAt(0).toUpperCase() + result.project.slice(1)} project update with ${result.details.length} key detail${result.details.length > 1 ? 's' : ''}`;
            }

            return result;
        }

        function smartQuery(query) {
            const lowerQuery = query.toLowerCase();
            let response = '';

            // Search voice memory for relevant information
            const relevantVoiceInputs = voiceMemory.filter(entry => {
                return entry.text.toLowerCase().includes(lowerQuery) ||
                       lowerQuery.split(' ').some(word => entry.text.toLowerCase().includes(word));
            });

            // Specific query patterns
            if (lowerQuery.includes('yellow') && (lowerQuery.includes('bird') || lowerQuery.includes('pallet'))) {
                response = searchForYellowBird();
            } else if (lowerQuery.includes('bahamas') || lowerQuery.includes('bahama')) {
                response = generateEnhancedBahamasReport();
            } else if (lowerQuery.includes('pending')) {
                response = generatePendingReport();
            } else if (lowerQuery.includes('timeline') || lowerQuery.includes('schedule')) {
                response = generateTimelineReport();
            } else if (lowerQuery.includes('budget') || lowerQuery.includes('money')) {
                response = generateBudgetReport();
            } else {
                // General search through voice memory
                response = searchVoiceMemory(query, relevantVoiceInputs);
            }

            return response;
        }

        function searchForYellowBird() {
            // Search through voice memory and project data for Yellow Bird mentions
            const yellowBirdInfo = [];
            
            voiceMemory.forEach(entry => {
                const text = entry.text.toLowerCase();
                if (text.includes('yellow bird') || text.includes('yellowbird')) {
                    // Extract pallet information
                    const palletMatch = text.match(/(\d+)\s+(pallets?|pallet)/i);
                    const dateMatch = text.match(/(january|february|march|april|may|june|july|august|september|october|november|december)\s+(\d{1,2})/i);
                    
                    yellowBirdInfo.push({
                        pallets: palletMatch ? palletMatch[1] : 'mentioned',
                        date: dateMatch ? `${dateMatch[1]} ${dateMatch[2]}` : 'date not specified',
                        fullText: entry.text.substring(0, 100) + '...',
                        timestamp: entry.processed
                    });
                }
            });

            if (yellowBirdInfo.length > 0) {
                const totalPallets = yellowBirdInfo.reduce((sum, info) => {
                    return sum + (parseInt(info.pallets) || 0);
                }, 0);

                return `
                    <div style="margin-bottom: 15px;">
                        <strong>üê¶ Yellow Bird Search Results</strong>
                    </div>
                    
                    <div style="background: rgba(255,193,7,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <strong>üì¶ Total Pallets Found:</strong> ${totalPallets > 0 ? totalPallets + ' pallets' : 'Pallets mentioned but quantity needs clarification'}
                    </div>

                    ${yellowBirdInfo.map(info => `
                        <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                            <strong>Pallets:</strong> ${info.pallets}<br>
                            <strong>Date:</strong> ${info.date}<br>
                            <strong>From voice note:</strong> "${info.fullText}"<br>
                            <small style="opacity: 0.7;">Recorded: ${info.timestamp}</small>
                        </div>
                    `).join('')}

                    <div class="timestamp">Query processed ${new Date().toLocaleString()}</div>
                `;
            } else {
                return `
                    <div style="margin-bottom: 15px;">
                        <strong>üê¶ Yellow Bird Search Results</strong>
                    </div>
                    
                    <div style="background: rgba(255,107,107,0.2); padding: 15px; border-radius: 10px;">
                        <strong>No Yellow Bird information found</strong><br>
                        Try recording a voice note about Yellow Bird orders, then ask again.
                    </div>
                `;
            }
        }

        function searchVoiceMemory(query, relevantInputs) {
            if (relevantInputs.length > 0) {
                return `
                    <div style="margin-bottom: 15px;">
                        <strong>üîç Search Results for: "${query}"</strong>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                        <strong>Found ${relevantInputs.length} relevant voice note${relevantInputs.length > 1 ? 's' : ''}:</strong><br><br>
                        ${relevantInputs.map(entry => `
                            ‚Ä¢ "${entry.text.substring(0, 150)}..."<br>
                            <small style="opacity: 0.7;">Recorded: ${entry.processed}</small>
                        `).join('<br><br>')}
                    </div>

                    <div class="timestamp">Search completed ${new Date().toLocaleString()}</div>
                `;
            } else {
                return `
                    <div>I searched for: "${query}"</div>
                    <div style="margin-top: 15px; background: rgba(255,165,2,0.2); padding: 15px; border-radius: 10px;">
                        No matching information found in voice notes. Try recording more details first, then search again.
                    </div>
                `;
            }
        }

        function handleQuickQuery(type) {
            const responseArea = document.getElementById('responseArea');
            let response = '';

            switch(type) {
                case 'bahamas':
                    response = generateEnhancedBahamasReport();
                    break;
                case 'pending':
                    response = generatePendingReport();
                    break;
                case 'timeline':
                    response = generateTimelineReport();
                    break;
                case 'budget':
                    response = generateBudgetReport();
                    break;
            }

            responseArea.innerHTML = response;
        }

        function generateEnhancedBahamasReport() {
            const data = projectData.bahamas;
            const voiceNotes = data.voiceNotes || [];
            
            return `
                <div style="margin-bottom: 15px;">
                    <strong>üèùÔ∏è Bahamas Project Status Report</strong>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <strong>Current Status:</strong> ${data.status}<br>
                    <strong>Progress:</strong> ${data.progress}<br>
                    <strong>Budget:</strong> ${data.budget}<br>
                    <strong>Timeline:</strong> ${data.timeline}
                </div>

                <div style="background: rgba(255,107,107,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <strong>‚ö†Ô∏è Critical Issue:</strong><br>
                    ${data.lastUpdate}
                </div>

                ${voiceNotes.length > 0 ? `
                    <div style="background: rgba(46,213,115,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <strong>üìù Recent Voice Updates:</strong><br>
                        ${voiceNotes.map(note => `‚Ä¢ ${note}`).join('<br>')}
                    </div>
                ` : ''}

                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                    <strong>Key Milestones:</strong><br>
                    ${data.keyMilestones.map(m => `‚Ä¢ ${m}`).join('<br>')}
                </div>

                <div class="timestamp">Updated ${new Date().toLocaleString()}</div>
            `;
        }

        function generatePendingReport() {
            return `
                <div style="margin-bottom: 15px;">
                    <strong>‚ö†Ô∏è Pending Items Across All Projects</strong>
                </div>
                
                <div style="background: rgba(255,107,107,0.2); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <strong>üö® Critical - Bahamas:</strong> Environmental permits approval needed
                </div>

                <div style="background: rgba(255,165,2,0.2); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <strong>üè¢ Office Renovation:</strong> Contractor selection overdue (4 weeks delayed)
                </div>

                <div style="background: rgba(255,165,2,0.2); padding: 15px; border-radius: 10px;">
                    <strong>üìä Miami Expansion:</strong> Final inspection scheduled for next week
                </div>

                <div class="timestamp">Alert generated ${new Date().toLocaleString()}</div>
            `;
        }

        function generateTimelineReport() {
            return `
                <div style="margin-bottom: 15px;">
                    <strong>üìÖ Project Timeline Overview</strong>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                    <div style="margin-bottom: 10px;"><strong>üèùÔ∏è Bahamas:</strong> 2 weeks behind, est. completion +3-4 weeks</div>
                    <div style="margin-bottom: 10px;"><strong>üöÄ Miami:</strong> On track, completion in 2 weeks</div>
                    <div><strong>üè¢ Office:</strong> 4 weeks delayed, needs immediate attention</div>
                </div>

                <div class="timestamp">Timeline updated ${new Date().toLocaleString()}</div>
            `;
        }

        function generateBudgetReport() {
            return `
                <div style="margin-bottom: 15px;">
                    <strong>üí∞ Budget Status Overview</strong>
                </div>
                
                <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                    <div style="margin-bottom: 10px;"><strong>üèùÔ∏è Bahamas:</strong> $850k / $1.2M (71% utilized)</div>
                    <div style="margin-bottom: 10px;"><strong>üöÄ Miami:</strong> $2.1M / $2.3M (91% utilized)</div>
                    <div style="margin-bottom: 10px;"><strong>üè¢ Office:</strong> $450k / $500k (90% utilized)</div>
                    <div style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px; margin-top: 10px;">
                        <strong>Total Allocated:</strong> $4M | <strong>Total Spent:</strong> $3.4M
                    </div>
                </div>

                <div class="timestamp">Budget updated ${new Date().toLocaleString()}</div>
            `;
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up dashboard...');
            
            // Initialize speech recognition first
            const speechAvailable = initializeSpeechRecognition();
            
            // Set up microphone button
            const recordBtn = document.getElementById('recordBtn');
            if (recordBtn) {
                recordBtn.addEventListener('click', function() {
                    console.log('Microphone button clicked!');
                    startRecording();
                });
                console.log('‚úÖ Microphone button ready');
            }

            // Set up query input
            const queryInput = document.getElementById('queryInput');
            if (queryInput) {
                queryInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const query = e.target.value;
                        console.log('Query entered:', query);
                        
                        // Use smart query system
                        const response = smartQuery(query);
                        document.getElementById('responseArea').innerHTML = response;
                        
                        e.target.value = '';
                    }
                });
                console.log('‚úÖ Query input ready');
            }

            // Set up quick query buttons
            const quickQueryBtns = document.querySelectorAll('.quick-query-btn');
            quickQueryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const queryType = this.getAttribute('data-query');
                    console.log('Quick query clicked:', queryType);
                    handleQuickQuery(queryType);
                });
            });
            console.log('‚úÖ Quick query buttons ready:', quickQueryBtns.length);

            console.log('üéØ Dashboard fully initialized!');
        });
    </script>
</body>
</html>
